# ChurnGuard: предсказание оттока клиентов (телеком)

Производственный ML-проект для прогноза оттока в телекоме. Финальная модель — **CatBoost**. В проекте реализован полный конвейер: проверка данных, фичеринг, PHIK‑анализ категориальных, выбор модели (LR / RF / CatBoost), тюнинг, **подбор порога на кросс‑валидации**, финальная оценка только на тесте и интерпретация через permutation importance.

---

## Главное
- **Целевая метрика:** ROC-AUC (нечувствительна к дисбалансу).
- **Финальная модель:** CatBoost (тюнинг + порог по OOF).
- **Test ROC-AUC:** ~0.92 (в требуемом диапазоне 0.85–0.95).
- **Готово к бизнесу:** понятная стратегия применения порога и действия ретеншна.

---

## Датасет (Telco-подобный)
- ~7k клиентов, контракт/биллинг/услуги
- Цель: `churn` (1 — договор завершён к дате среза; 0 — активен)
- Дата среза: `2020‑02‑01`

### Разметка и валидация
- `churn = 1`, если `EndDate` **заполнен** (включая `EndDate == дате среза`); иначе `0`.
- Стаж/длительность считаем по **эффективной дате окончания**: `EndDate` для ушедших; дата среза — для активных.

### Работа с пропусками
- **Бизнес‑пропуски ≠ «дырки» в данных.**
- Интернет/телефония: пропуски → явные категории (“No internet service”, “No phone service”).
- `total_charges`: `0` **только при tenure=0**; иначе медиана.
- Кодирование — **обучаемыми трансформерами** (без ручного маппинга).

---

## Финальный набор фич (14)
```
payment_group, monthly_charges, total_charges, partner, contract_duration,
multiple_lines, online_backup, device_protection, streaming_movies,
senior_citizen, dependents, type, internet_service, paperless_billing_yes
```
Покрывает поведение оплаты, цену/стаж, пакет услуг, тип контракта и базовую демографию. Исключены утечки и тяжёлая мультиколлинеарность.

---

## Моделирование
- **Pipeline-ы**
  - LogisticRegression: `OHE(drop='first')` + `StandardScaler` для числовых.
  - RandomForest: `OrdinalEncoder` для категориальных.
  - CatBoost: родная обработка категориальных через `cat_features`.
- **Выбор модели** — 5‑fold CV (ROC-AUC).
- **Тюнинг**: быстрый `RandomizedSearchCV` (3‑fold) → проверка на 5‑fold.
- **Порог**: **cross_val_predict** (OOF) + критерий Юдена (tpr−fpr).
- **Тест**: оцениваем **только лучшую модель** (CatBoost).

### Результаты (типичный запуск)
- CV ROC-AUC (CatBoost tuned): ~0.90
- **TEST ROC-AUC:** ~0.92; **Accuracy:** ~0.86; **F1:** ~0.66 при пороге ≈ 0.18
- Матрица ошибок (пример): `TN=1292, FP=194, FN=46, TP=229`

### Интерпретация (Permutation Importance, TEST)
Топ‑драйверы (ΔAUC):
1) `device_protection` (~0.29–0.31) — сильнейший сигнал среди доп‑услуг  
2) `multiple_lines` (~0.08–0.13) — наличие телефонии  
3) `total_charges` (~0.05–0.06) — кумулятивные платежи / жизненный цикл  
Далее: `partner`, `online_backup`, `streaming_movies`


---

## Как применять в бизнесе
- Сегментация по вероятности оттока; текущая рабочая точка ориентирована на **полноту** (меньше пропусков оттока).
- Если бюджет ограничен — поднимайте порог для роста precision (и снижения объёма контактов).
- В приоритете клиенты **без `device_protection`**, без телефонии (`multiple_lines`), с низкими `total_charges`.

---

## Лицензия
MIT (или другая по политике организации).
